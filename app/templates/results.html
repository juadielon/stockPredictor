<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Stock Predictor - Results</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />

    <!-- Stylesheets -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1"
      crossorigin="anonymous"
    />

    <!-- Scripts -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW"
      crossorigin="anonymous"
    ></script>
  </head>

  <body>
    <div class="container">
      <h1>Stock Predictor - Results</h1>
      <h2>{{ stock_info['longName'] }} - {{ stock_info['symbol']}}</h2>
      <dl class="row">
        <dt class="col-sm-1">Summary:</dt>
        <dd class="col-sm-11">{{ stock_info['longBusinessSummary'] }}</dd>
        <dt class="col-sm-1">Type:</dt>
        <dd class="col-sm-11">{{ stock_info['legalType'] }}</dd>
        <dt class="col-sm-1">Exchange:</dt>
        <dd class="col-sm-11">{{ stock_info['exchange']}}</dd>
        <dt class="col-sm-1">Currency</dt>
        <dd class="col-sm-11">{{ stock_info['currency']}}</dd>
      </dl>
    </div>

    <div class="container">
      <div class="row">
        <div class="col-9">
          <table class="table table-striped table-hover caption-top">
            <caption>
              Most recent values
            </caption>
            <thead>
              <tr>
                <th scope="col">Nav</th>
                <th scope="col">Previous close</th>
                <th scope="col">Open</th>
                <th scope="col">Ask</th>
                <th scope="col">Bid</th>
                <th scope="col">Day low</th>
                <th scope="col">Day high</th>
                <th scope="col">Volume</th>
                <th scope="col">
                  <abbr
                    title="Earnings/Price - cents of earning per dollar invested"
                    >Yield</abbr
                  >
                </th>
                <!--
            <th scope="col">Last dividend date</th>
            <th scope="col">Last dividend</th>
            -->
              </tr>
            </thead>
            <tbody>
              <tr>
                <td scope="col">{{ stock_info['navPrice'] }}</td>
                <td scope="col">{{ stock_info['previousClose'] }}</td>
                <td scope="col">{{ stock_info['open'] }}</td>
                <td scope="col">{{ stock_info['ask'] }}</td>
                <td scope="col">{{ stock_info['bid'] }}</td>
                <td scope="col">{{ stock_info['dayLow'] }}</td>
                <td scope="col">{{ stock_info['dayHigh'] }}</td>
                <td scope="col">{{ '{:,}'.format(stock_info['volume']) }}</td>
                <td scope="col">{{ stock_info['yield'] * 100 }}%</td>
                <!--
                <td scope="col">{{ stock_info['lastDividendDate'] }}</td>
                <td scope="col">{{ stock_info['lastDividend'] }}</td>
                -->
              </tr>
            </tbody>
          </table>
        </div>

        <div class="col-3">
          <table class="table table-striped table-hover caption-top">
            <caption>
              Dividends
            </caption>
            <thead>
              <tr>
                <th scope="col">Date</th>
                <th scope="col">Amount</th>
              </tr>
            </thead>
            <tbody>
              {% for date, amount in dividends.items() %}
              <tr>
                <td>{{ date.strftime('%d/%m/%Y') }}</td>
                <td>{{ amount }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="container">
      <h2>Forecast</h2>
      <p>
        Forecasting stock prices of <b>{{ ticker }}</b> for the next
        <b>{{ days }}</b> days.
      </p>

      <table class="table table-striped table-hover">
        <thead>
          <tr>
            <th scope="col">Date (ds)</th>
            <th scope="col">Predicted price (yhat)</th>
            <th scope="col">yhat lower</th>
            <th scope="col">yhat upper</th>
          </tr>
        </thead>
        <tbody>
          {% for row in forecast %}
          <tr>
            <td>{{ row.ds.strftime('%d/%m/%Y') }}</td>
            <td>{{ row.yhat|round(4) }}</td>
            <td>{{ row.yhat_lower|round(4) }}</td>
            <td>{{ row.yhat_upper|round(4) }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div class="container">
      <div class="row">
        <img
          src="{{ fig_paths.price }}"
          class="img-fluid"
          alt="Price {{ ticker }}"
        />
      </div>
      <div class="row">
        <img
          src="{{ fig_paths.forecast }}"
          class="img-fluid"
          alt="Forecast {{ ticker }}"
        />
      </div>
      <div class="row">
        <img
          src="{{ fig_paths.components }}"
          class="img-fluid"
          alt="Components {{ ticker }}"
        />
      </div>
    </div>

    <div class="container">
      <h2>Model diagnostics</h2>
      <table class="table table-striped table-hover">
        <thead>
          <tr>
            <th scope="col">horizon</th>
            <th scope="col">mse</th>
            <th scope="col">rmse</th>
            <th scope="col">mae</th>
            <th scope="col">mape</th>
            <th scope="col">mdape</th>
            <th scope="col">coverage</th>
          </tr>
        </thead>
        <tbody>
          {% for row in performance %}
          <tr>
            <td>{{ (row.horizon|string)[:-9] }}</td>
            <td>{{ row.mse|round(4) }}</td>
            <td>{{ row.rmse|round(4) }}</td>
            <td>{{ row.mae|round(4) }}</td>
            <td>{{ row.mape|round(4) }}</td>
            <td>{{ row.mdape|round(4) }}</td>
            <td>{{ row.coverage|round(4) }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <div class="container">
      <div class="row">
        <img
          src="{{ fig_paths.mape }}"
          class="img-fluid"
          alt="mape {{ ticker }}"
        />
      </div>
    </div>
  </body>
</html>
